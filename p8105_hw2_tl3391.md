hw2
================
Tong Liu
2025-10-01

\##load packages

``` r
library(tidyverse)
```

    ## ── Attaching core tidyverse packages ──────────────────────── tidyverse 2.0.0 ──
    ## ✔ dplyr     1.1.4     ✔ readr     2.1.5
    ## ✔ forcats   1.0.0     ✔ stringr   1.5.1
    ## ✔ ggplot2   3.5.2     ✔ tibble    3.3.0
    ## ✔ lubridate 1.9.4     ✔ tidyr     1.3.1
    ## ✔ purrr     1.1.0     
    ## ── Conflicts ────────────────────────────────────────── tidyverse_conflicts() ──
    ## ✖ dplyr::filter() masks stats::filter()
    ## ✖ dplyr::lag()    masks stats::lag()
    ## ℹ Use the conflicted package (<http://conflicted.r-lib.org/>) to force all conflicts to become errors

``` r
library(tidyr)
library(readr)
library(janitor)
```

    ## 
    ## Attaching package: 'janitor'
    ## 
    ## The following objects are masked from 'package:stats':
    ## 
    ##     chisq.test, fisher.test

``` r
library(lubridate)
```

\###Question1

\##Read in the pols data

``` r
pols_month = read_csv("data/pols-month.csv") %>%
  clean_names()
```

    ## Rows: 822 Columns: 9
    ## ── Column specification ────────────────────────────────────────────────────────
    ## Delimiter: ","
    ## dbl  (8): prez_gop, gov_gop, sen_gop, rep_gop, prez_dem, gov_dem, sen_dem, r...
    ## date (1): mon
    ## 
    ## ℹ Use `spec()` to retrieve the full column specification for this data.
    ## ℹ Specify the column types or set `show_col_types = FALSE` to quiet this message.

``` r
unemployment = read_csv("data/unemployment.csv") %>%
  clean_names()
```

    ## Rows: 68 Columns: 13
    ## ── Column specification ────────────────────────────────────────────────────────
    ## Delimiter: ","
    ## dbl (13): Year, Jan, Feb, Mar, Apr, May, Jun, Jul, Aug, Sep, Oct, Nov, Dec
    ## 
    ## ℹ Use `spec()` to retrieve the full column specification for this data.
    ## ℹ Specify the column types or set `show_col_types = FALSE` to quiet this message.

``` r
snp = read_csv("data/snp.csv") %>%
  clean_names()
```

    ## Rows: 787 Columns: 2
    ## ── Column specification ────────────────────────────────────────────────────────
    ## Delimiter: ","
    ## chr (1): date
    ## dbl (1): close
    ## 
    ## ℹ Use `spec()` to retrieve the full column specification for this data.
    ## ℹ Specify the column types or set `show_col_types = FALSE` to quiet this message.

\##Clean the pol_month dataset

``` r
pols_clean = pols_month %>%
  separate(mon, into = c("year","month","day")) %>%
  mutate(
    day = as.numeric(day),
    month = as.numeric(month),
    year = as.numeric(year),
    month = month(month, label = TRUE, abbr = FALSE),
    president = if_else(prez_gop == 1, "gop", "dem")
  ) %>%
  select(-day, -prez_gop, -prez_dem)
```

\##Clean the snp dataset

``` r
snp_clean = snp %>%
  mutate(date = mdy(date)) %>%
  transmute(
    year  = year(date),
    month = month(date, label = TRUE, abbr = FALSE),
    close
  ) %>%
  arrange(year, month, close)
```

\##Clean the unemployment dataset

``` r
unemployment_clean = unemployment %>%
  pivot_longer(
    cols = jan:dec,
    names_to = "month",
    values_to = "unemployment"
  ) %>%
  mutate(
    month = match(month, tolower(month.abb)),
    month = month(month, label = TRUE, abbr = FALSE)
  ) %>%
  select(year, month, unemployment)
```

\##Merge the datasets

``` r
result = pols_clean %>%
  left_join(snp_clean,  by = c('year','month')) %>%
  left_join(unemployment_clean, by = c('year','month'))
```

\##Report datasets Cleaned datasets

``` r
dim(pols_clean)
```

    ## [1] 822   9

``` r
dim(snp_clean)
```

    ## [1] 787   3

``` r
dim(unemployment_clean)
```

    ## [1] 816   3

``` r
range(pols_clean$year)
```

    ## [1] 1947 2015

``` r
range(snp_clean$year)
```

    ## [1] 1969 2068

``` r
range(unemployment_clean$year)
```

    ## [1] 1948 2015

``` r
names(pols_clean)
```

    ## [1] "year"      "month"     "gov_gop"   "sen_gop"   "rep_gop"   "gov_dem"  
    ## [7] "sen_dem"   "rep_dem"   "president"

``` r
names(snp_clean)
```

    ## [1] "year"  "month" "close"

``` r
names(unemployment_clean)
```

    ## [1] "year"         "month"        "unemployment"

The pols_month dataset’s dimension is 822\*9, and the variable year
ranging from 1948 to 2015. It contains key variables including year,
month, gov_gop, sen_gop,rep_gop,gov_dem,sen_dem,rep_dem, and president.

The snp dataset’s dimension is 787\*3, and the variable year ranging
from 1969 to 2068. It contain key variables including year, month, and
close, which is the closing values of the S&P stock index on the
associated date.

The unemployment dataset’s dimension is 816\*3, and the variable year
ranging from 1948 to 2015. It contains key variables including year,
month, and unemployment, which is the percentage of unemployment.

Merged dataset

``` r
dim(result)
```

    ## [1] 822  11

``` r
range(result$year)
```

    ## [1] 1947 2015

``` r
names(result)
```

    ##  [1] "year"         "month"        "gov_gop"      "sen_gop"      "rep_gop"     
    ##  [6] "gov_dem"      "sen_dem"      "rep_dem"      "president"    "close"       
    ## [11] "unemployment"

The merged dataset’s dimension is 822\*11 because we merged the
duplicate year and month in the snp and unemployment dataset, which gave
us 9+1+1 = 11 columns. The ranging if variable year goes from 1947 to
2015. It contains key variables including year, month, gov_gop,
sen_gop,rep_gop,gov_dem,sen_dem,rep_dem, and president, close and
unemployment.

\###Question 2

\##Read in the mr trash wheel dataset

``` r
mr_data = readxl::read_excel("./data/202509 Trash Wheel Collection Data.xlsx",
  sheet = "Mr. Trash Wheel",                 
  range = "A2:N709")
```

\##Clean the mr trash wheel dataset

``` r
mr_clean = mr_data %>%
  janitor::clean_names() %>%
  filter(!is.na(dumpster)) %>%
  mutate(
    year = as.numeric(year),
    date = as_date(date),
    sports_balls = as.integer(sports_balls)
    )
```

\##Read in the professor trash wheel dataset

``` r
prof_data = readxl::read_excel("./data/202509 Trash Wheel Collection Data.xlsx",
  sheet = "Professor Trash Wheel",
  range = "A2:M134")
```

\##Clean the professor trash wheel dataset

``` r
prof_clean = prof_data %>%
  janitor::clean_names() %>%
  filter(!is.na(dumpster))
```

\##Read in the Gwynns trash wheel dataset

``` r
gwyn_data = readxl::read_excel("./data/202509 Trash Wheel Collection Data.xlsx",
  sheet = "Gwynns Falls Trash Wheel",
  range = "A2:L351")
```

\##Clean the Gwynns trash wheel dataset

``` r
gwyn_clean = gwyn_data %>%
  janitor::clean_names() %>%
  filter(!is.na(dumpster))
```

\##Combine datasets

``` r
wheel = bind_rows(mr_clean, prof_clean,gwyn_clean) %>%
  select(dumpster, year, month, date, everything())
```

\##Calculate for total weight of trash collected by professor trash
wheel and total number of cigeratte butts collected by Gwynnda in June
2022

``` r
prof_total_weight = prof_clean %>%
  summarise(total_tons = sum(weight_tons, na.rm = TRUE))
gwyn_cig_June2022 = gwyn_clean %>%
  filter(month == "June" & year == 2022) %>%
  summarise(total_cig_butts = sum(cigarette_butts, na.rm = TRUE))
```

\##Description and report for the calculation result The combined Trash
Wheel dataset has 1188 rows and 14 columns. The variables include:

dumpster, year, month, date, weight_tons, volume_cubic_yards,
plastic_bottles, polystyrene, cigarette_butts, glass_bottles,
plastic_bags, wrappers, sports_balls, homes_powered.

The dataset spans from 2014-05-16 to 2025-07-29.

The total weight of trash collected by Professor Trash Wheel was 282.26
tons.

The total number of cigarette butts collected by Gwynnda in June 2022
was 18,120.

\###Question 3

\##import the dataset

``` r
zori_data = read_csv("data/Zip_zori_uc_sfrcondomfr_sm_month_NYC.csv") %>%
  janitor::clean_names() 
```

    ## Rows: 149 Columns: 125
    ## ── Column specification ────────────────────────────────────────────────────────
    ## Delimiter: ","
    ## chr   (6): RegionType, StateName, State, City, Metro, CountyName
    ## dbl (119): RegionID, SizeRank, RegionName, 2015-01-31, 2015-02-28, 2015-03-3...
    ## 
    ## ℹ Use `spec()` to retrieve the full column specification for this data.
    ## ℹ Specify the column types or set `show_col_types = FALSE` to quiet this message.

``` r
zip_data = read_csv("data/Zip Codes.csv") %>%
  janitor::clean_names() %>%
  mutate(
    region_name = zip_code,
    county_name = paste0(county, " County")
  )
```

    ## Rows: 322 Columns: 7
    ## ── Column specification ────────────────────────────────────────────────────────
    ## Delimiter: ","
    ## chr (4): County, County Code, File Date, Neighborhood
    ## dbl (3): State FIPS, County FIPS, ZipCode
    ## 
    ## ℹ Use `spec()` to retrieve the full column specification for this data.
    ## ℹ Specify the column types or set `show_col_types = FALSE` to quiet this message.

\##Merge two datasets

``` r
zillow_full = left_join(zori_data,zip_data,by = c("county_name","region_name")) %>%
  select(size_rank, region_id, region_name, region_type, zip_code,state, state_name, state_fips, city, metro,
    county, county_name, county_code, county_fips,neighborhood, file_date,everything())
```

\##Clean the merged dataset

``` r
zillow_clean = zillow_full %>%
  pivot_longer(
    col = x2015_01_31:x2024_08_31,
    values_to = "rent",
    names_to = "date") %>%
  mutate(
    date = substr(date, start = 2, stop = 11),
    date = as_date(date)
  )
```

\##Summaerization of the dataset

``` r
summary(zillow_clean)
```

    ##    size_rank       region_id       region_name    region_type       
    ##  Min.   :    4   Min.   : 61615   Min.   :10001   Length:17284      
    ##  1st Qu.:  142   1st Qu.: 61657   1st Qu.:10044   Class :character  
    ##  Median : 1025   Median : 62005   Median :10473   Mode  :character  
    ##  Mean   : 2533   Mean   : 66415   Mean   :10737                     
    ##  3rd Qu.: 3485   3rd Qu.: 62045   3rd Qu.:11233                     
    ##  Max.   :30490   Max.   :399546   Max.   :11693                     
    ##                                                                     
    ##     zip_code        state            state_name          state_fips 
    ##  Min.   :10001   Length:17284       Length:17284       Min.   :36   
    ##  1st Qu.:10043   Class :character   Class :character   1st Qu.:36   
    ##  Median :10472   Mode  :character   Mode  :character   Median :36   
    ##  Mean   :10731                                         Mean   :36   
    ##  3rd Qu.:11232                                         3rd Qu.:36   
    ##  Max.   :11692                                         Max.   :36   
    ##  NA's   :116                                           NA's   :116  
    ##      city              metro              county          county_name       
    ##  Length:17284       Length:17284       Length:17284       Length:17284      
    ##  Class :character   Class :character   Class :character   Class :character  
    ##  Mode  :character   Mode  :character   Mode  :character   Mode  :character  
    ##                                                                             
    ##                                                                             
    ##                                                                             
    ##                                                                             
    ##  county_code         county_fips    neighborhood        file_date        
    ##  Length:17284       Min.   :36005   Length:17284       Length:17284      
    ##  Class :character   1st Qu.:36047   Class :character   Class :character  
    ##  Mode  :character   Median :36061   Mode  :character   Mode  :character  
    ##                     Mean   :36056                                        
    ##                     3rd Qu.:36081                                        
    ##                     Max.   :36085                                        
    ##                     NA's   :116                                          
    ##       date                 rent     
    ##  Min.   :2015-01-31   Min.   :1102  
    ##  1st Qu.:2017-06-22   1st Qu.:2244  
    ##  Median :2019-11-15   Median :2701  
    ##  Mean   :2019-11-14   Mean   :2889  
    ##  3rd Qu.:2022-04-07   3rd Qu.:3373  
    ##  Max.   :2024-08-31   Max.   :8423  
    ##                       NA's   :6834

\##Summarization continued

``` r
n_obs = nrow(zillow_clean)
n_vars = ncol(zillow_clean)
n_zip = n_distinct(zillow_clean$zip_code)
n_hood = n_distinct(zillow_clean$neighborhood)
var_names = names(zillow_clean)
```

There are 17284 observations in total in the dateset. An there are 18
variables, which are “size_rank”,“region_id”,“region_name”,
“region_type”,“zip_code”,“state”,“state_name”,“state_fips”,“city”,“metro”,“county”,“county_name”,county_code”,“county_fips”,“neighborhood”,
“file_date”,“date”,and “rent”. It also contains 43 distinct
neighborhoods and 149 distinct zip codes.

\##Find ZIP codes appear in the ZIP code dataset but not in the Zillow
Rental Price dataset

``` r
missing_zips = anti_join(zip_data, zillow_clean, by = "zip_code")
missing_zip_codes = unique(missing_zips$zip_code)
head(missing_zip_codes)
```

    ## [1] 10464 10474 10475 10499 10550 10704

There are 172 ZIP codes that appear in the ZIP code dataset but not in
the Zillow dataset. This might occur because some zip codes have
insufficient rental data, or becasue some of them were created recently
and was not added to the dataset.

\##compare rental prices in January 2021 to prices in January 2020.

``` r
zillow_compare = zillow_clean %>%
  filter(date %in% ymd(c("2020-01-31", "2021-01-31"))) %>%
  select(zip_code, county_name, neighborhood, date, rent) %>%
  tidyr::pivot_wider(
    names_from = date,
    values_from = rent,
    names_glue = "rent_{format(date, '%Y_%m_%d')}"
  ) %>%
  mutate(
    drop_in_price = rent_2020_01_31 - rent_2021_01_31
  ) %>%
  arrange(desc(drop_in_price)) %>%
  slice(1:10) %>%
  select(zip_code, county_name, neighborhood, drop_in_price)
print(zillow_compare, n = 10)
```

    ## # A tibble: 10 × 4
    ##    zip_code county_name     neighborhood                  drop_in_price
    ##       <dbl> <chr>           <chr>                                 <dbl>
    ##  1    10007 New York County Lower Manhattan                        913.
    ##  2    10069 New York County <NA>                                   748.
    ##  3    10009 New York County Lower East Side                        714.
    ##  4    10016 New York County Gramercy Park and Murray Hill          712.
    ##  5    10001 New York County Chelsea and Clinton                    710.
    ##  6    10002 New York County Lower East Side                        710.
    ##  7    10004 New York County Lower Manhattan                        706.
    ##  8    10038 New York County Lower Manhattan                        698.
    ##  9    10012 New York County Greenwich Village and Soho             686.
    ## 10    10010 New York County Gramercy Park and Murray Hill          685.

The table above shows the 10 ZIP codes with the largest decline in
rental prices between January 2020 and January 2021.The top 10 ZIP codes
with the largest rent declines from January 2020 to January 2021 are all
in New York County. The sharpest drop was in 10007 with about 913 units.
